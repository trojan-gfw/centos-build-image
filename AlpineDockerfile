FROM alpine:latest

MAINTAINER msl4437(https://github.com/msl4437)

RUN apk update && \
    apk add build-base perl linux-headers && \
    wget --no-check-certificate https://github.com/openssl/openssl/archive/OpenSSL_1_1_1i.tar.gz && \
    tar -zxf OpenSSL_1_1_1i.tar.gz && \
    cd openssl-OpenSSL_1_1_1i && \
    ./config --openssldir=/etc/ssl enable-ec_nistp_64_gcc_128 no-ssl2 no-ssl3 no-comp no-idea no-dtls no-dtls1 no-shared no-psk no-srp no-ec2m no-weak-ssl-ciphers && \
    make install_sw && \
    cd .. && \
    rm -rf OpenSSL_1_1_1i.tar.gz openssl-OpenSSL_1_1_1i && \

    wget --no-check-certificate https://github.com/Kitware/CMake/releases/download/v3.17.0/cmake-3.17.0.tar.gz && \
    tar -zxf cmake-3.17.0.tar.gz && \
    cd cmake-3.17.0 && \
    ./bootstrap -- && \
    make -j$(nproc) install && \
    cd .. && \
    rm -rf cmake-3.17.0.tar.gz cmake-3.17.0 && \

    wget --no-check-certificate https://dl.bintray.com/boostorg/release/1.72.0/source/boost_1_72_0.tar.gz && \
    tar -zxf boost_1_72_0.tar.gz && \
    cd boost_1_72_0 && \
    ./bootstrap.sh && \
    ./b2 -j$(nproc) --with-system --with-program_options variant=release link=static threading=multi runtime-link=shared install && \
    cd .. && \
    rm -rf boost_1_72_0.tar.gz boost_1_72_0 && \

    wget --no-check-certificate https://github.com/mariadb-corporation/mariadb-connector-c/archive/v3.1.7.tar.gz && \
    tar -zxf v3.1.7.tar.gz && \
    cd mariadb-connector-c-3.1.7 && \
    echo "TARGET_LINK_LIBRARIES(libmariadb pthread)" >> libmariadb/CMakeLists.txt && \
    cmake -DWITH_CURL=OFF -DWITH_DYNCOL=OFF -DWITH_MYSQLCOMPAT=ON -DWITH_UNIT_TESTS=OFF . && \
    make -j$(nproc) install && \
    cd .. && \
    rm -rf v3.1.7.tar.gz mariadb-connector-c-3.1.7
